package com.mondospider.spiderlocationapi;

import java.io.IOException;

import javax.jdo.PersistenceManager;
import javax.servlet.http.*;

import com.sun.servicetag.UnauthorizedAccessException;

@SuppressWarnings("serial")
public class SetSpiderLocation extends HttpServlet {
	private static final String SECRET_KEY = "spiders_secret_key";

	public void doGet(HttpServletRequest req, HttpServletResponse resp)
			throws IOException {
		resp.setContentType("text/plain");
		
		
		if ( !isSecretKeyTrue(req.getParameter("pwd")) )  {
			//accessDenied		
			resp.getWriter().println(" {\n\"error\":\"Wrong Key\" }");
		}
		
		long lat = req.getParameter("lat");		
		long lat = req.getParameter("log");
			
			
		updatePosition("spider", 12317771L, 12776552L);
		
		System.out.println();
		
		

		
		
	}
	

	private boolean isSecretKeyTrue(String key) {
		return key.equals(SECRET_KEY);
	}

	public void updatePosition(String username, long latitude,  long longitude) {
		
	    PersistenceManager pm = PMF.get().getPersistenceManager();
	    try {
	    
	        Location l = pm.getObjectById(Location.class, username);
	        l.setLatetude(latitude+1);
	        l.setLongitude(longitude+1);
	        
	    } finally {
	        pm.close();
	    }
	}
	
}
