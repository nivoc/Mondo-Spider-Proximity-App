package com.mondospider.spiderlocationapi;

import java.io.IOException;

import javax.jdo.PersistenceManager;
import javax.servlet.http.*;

@SuppressWarnings("serial")
public class SetSpiderLocation extends HttpServlet {
	public void doGet(HttpServletRequest req, HttpServletResponse resp)
			throws IOException {
		

		
		
		
		PersistenceManager pm = PMF.get().getPersistenceManager();
		Location loc = new Location("spider", 12317771L, 12776552L);

		try {

			pm.makePersistent(loc);

		} finally {

			pm.close();

		}

		resp.setContentType("text/plain");
		resp.getWriter().println(
				"{" + "\n\"latitude\":" + loc.getLatitude() + ","
						+ "\n\"longitude\":" + loc.getLongitude() + ","
						+ "\n\"lastupdate\":" + loc.getCreatedAt() + ","
						+ "\n}");
	}
	
	public void updatePosition(String username, long latitude,  long longitude) {
		
	    PersistenceManager pm = PMF.get().getPersistenceManager();
	    try {
	    	
	    	
	        Location l = pm.getObjectById(Location.class, username);
	        
	        if (titleChangeIsAuthorized(e, newTitle) {
	            e.setTitle(newTitle);
	        } else {
	            throw new UnauthorizedTitleChangeException(e, newTitle);
	        }
	    } finally {
	        pm.close();
	    }
	}
	
}
